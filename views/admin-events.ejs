<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/main.css" />
    <title>Manage All Events</title>
</head>
<body>
    <div class="header">
        <h1>Manage All Events</h1>
        <div class="user-info">
            Welcome, <%= user.name %> 
            <a href="/logout" class="btn-logout">Logout</a>
        </div>
    </div>
    
    <div class="nav-menu">
        <a href="/admin" class="nav-link">Dashboard</a>
        <a href="/admin/users" class="nav-link">Manage Users</a>
        <a href="/admin/events" class="nav-link active">Manage Events</a>
        <a href="/organiser" class="nav-link">Create Events</a>
        <a href="/admin/settings" class="nav-link">Site Settings</a>
    </div>
    
    <div class="content">
        <div class="actions">
            <a href="/organiser/create-event" class="btn-primary">Create New Event</a>
        </div>
        
        <h2>All Events in System</h2>
        
        <% if (events.length === 0) { %>
            <div class="no-events">
                <p>No events have been created yet.</p>
                <a href="/organiser/create-event" class="btn-primary">Create First Event</a>
            </div>
        <% } else { %>
            <table>
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Creator</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th>Created</th>
                        <th>Tickets</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% events.forEach(event => { %>
                        <tr>
                            <td><%= event.title %></td>
                            <td><%= event.creator_name %></td>
                            <td><%= new Date(event.event_date).toLocaleDateString() %></td>
                            <td>
                                <% if (event.status === 'published') { %>
                                    <span class="status-badge published">Published</span>
                                <% } else { %>
                                    <span class="status-badge draft">Draft</span>
                                <% } %>
                            </td>
                            <td><%= new Date(event.created_date).toLocaleDateString() %></td>
                            <td>
                                Full: <%= event.full_price_tickets %> ($<%= event.full_price_cost %>)<br>
                                Concession: <%= event.concession_tickets %> ($<%= event.concession_cost %>)
                            </td>
                            <td>
                                <a href="/organiser/edit-event/<%= event.event_id %>" class="btn-small">Edit</a>
                                <% if (event.status === 'published') { %>
                                    <a href="/events/<%= event.event_id %>" class="btn-small">View</a>
                                <% } else { %>
                                    <form action="/organiser/publish-event/<%= event.event_id %>" method="post" style="display: inline;">
                                        <button type="submit" class="btn-secondary btn-small">Publish</button>
                                    </form>
                                <% } %>
                                <form action="/admin/events/<%= event.event_id %>/delete" method="post" style="display: inline;">
                                    <button type="submit" class="btn-danger btn-small" 
                                            onclick="return confirm('Are you sure you want to delete this event? This action cannot be undone.')">Delete</button>
                                </form>
                            </td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        <% } %>
    </div>
</body>
</html>